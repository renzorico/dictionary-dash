<!DOCTYPE html>
<html>
<head>
  <title>Dictionary Access Game</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 40px; }
    input, button { padding: 10px; font-size: 1em; margin: 10px; width: 300px; }
    code { background-color: #f2f2f2; padding: 4px; display: block; margin: 20px auto; width: fit-content; white-space: pre-wrap; }
    #result { font-weight: bold; margin-top: 20px; font-size: 1.2em; }
  </style>
</head>
<body>
  <h1>üîç Access the Value</h1>
  <p>Write the expression that accesses the target value from the dictionary</p>
  <div id="question"></div>
  <input id="input" type="text" placeholder="e.g., dict_['fruit']" />
  <br>
  <button onclick="checkAnswer()">Check Answer</button>
  <button onclick="newChallenge()">Next Challenge</button>
  <div id="result"></div>

  <script>
    function generateRandomDict(depth = 1) {
      const keys = ["fruit", "color", "shape", "animal", "city", "country", "language", "brand", "product", "size"];
      const values = ["apple", "red", "round", "dog", "Paris", "Spain", "French", "Nike", "shoes", 42];
      const dict = {};
      const usedKeys = new Set();
      for (let i = 0; i < Math.floor(Math.random() * 3) + 3; i++) {
        let key;
        do {
          key = keys[Math.floor(Math.random() * keys.length)];
        } while (usedKeys.has(key));
        usedKeys.add(key);

        const val = (depth > 1 && Math.random() > 0.3) ? generateRandomDict(depth - 1) : values[Math.floor(Math.random() * values.length)];
        dict[key] = val;
      }
      return dict;
    }

    function findTarget(dict, path = []) {
      for (const key in dict) {
        const val = dict[key];
        if (typeof val !== "object") {
          return { path: [...path, key], val };
        }
        const nested = findTarget(val, [...path, key]);
        if (nested) return nested;
      }
    }

    let currentDict, expectedCode;

    function newChallenge() {
      currentDict = generateRandomDict(3);
      const { path, val } = findTarget(currentDict);
      expectedCode = `dict_${path.map(k => `['${k}']`).join('')}`;

      document.getElementById("question").innerHTML =
        `<code>dict_ : ${JSON.stringify(currentDict, null, 2)}</code><br><code>Get to the value '${val}'</code>`;
      document.getElementById("input").value = "";
      document.getElementById("result").textContent = "";
    }

    function checkAnswer() {
      const userCode = document.getElementById("input").value;
      try {
        const dict_ = currentDict;
        const result = eval(userCode);
        const expected = eval(expectedCode);
        if (result === expected) {
          document.getElementById("result").textContent = "‚úÖ Correct!";
        } else {
          document.getElementById("result").textContent = `‚ùå Incorrect. That gives '${result}'`;
        }
      } catch (e) {
        document.getElementById("result").textContent = "‚ö†Ô∏è Error in your expression";
      }
    }

    newChallenge();
  </script>
</body>
</html>
